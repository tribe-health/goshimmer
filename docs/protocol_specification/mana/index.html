<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="GoShimmer Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="GoShimmer Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">Mana Implementation | GoShimmer</title><meta data-react-helmet="true" property="og:url" content="https://goshimmer.docs.iota.org//docs/protocol_specification/mana"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mana Implementation | GoShimmer"><meta data-react-helmet="true" name="description" content="This document provides a high level overview of how mana is implemented in GoShimmer."><meta data-react-helmet="true" property="og:description" content="This document provides a high level overview of how mana is implemented in GoShimmer."><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://goshimmer.docs.iota.org//docs/protocol_specification/mana"><link data-react-helmet="true" rel="alternate" href="https://goshimmer.docs.iota.org//docs/protocol_specification/mana" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://goshimmer.docs.iota.org//docs/protocol_specification/mana" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e8df95d8.css">
<link rel="preload" href="/assets/js/runtime~main.dedbe278.js" as="script">
<link rel="preload" href="/assets/js/main.0e69db9d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">GoShimmer</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/welcome">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/iotaledger/Goshimmer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">GoShimmer</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/welcome">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/iotaledger/Goshimmer" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/welcome">Welcome</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/setup">Set up a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/send_transaction">Obtain tokens</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/wallet-library">Wallet library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/dApp">Write a dApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/manual_peering">Manual peering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/static_identity">Create a static identity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/custom_dRNG">Set up a custom dRNG committee</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/monitoring">Set up the Monitoring Dashboard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/send_transaction">How to create and send transactions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Implementation design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/implementation_design/event_driven_model">Event driven model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/implementation_design/packages_plugins">Packages and plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/implementation_design/plugin">Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/implementation_design/configuration_parameters">Configuration parameters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/implementation_design/object_storage">Object storage</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Protocol Specification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification">Protocol Specification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/protocol">Protocol High Level Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/components">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/tangle">Tangle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/autopeering">Autopeering</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/protocol_specification/mana">Mana</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/congestion_control">Congestion Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/consensus_mechanism">Consensus Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/ledgerstate">UTXO and Ledgerstate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/advanced_outputs">Advanced Outputs (Experimental)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/markers">Markers</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/protocol_specification/glossary">Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/api">Client Lib</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/webAPI">WebAPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/info">Node Info</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/autopeering">Autopeering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/manual_peering">Manual Peering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/communication">Communication Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/ledgerstate">Ledgerstate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/mana">Mana</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/dRNG">dRNG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/snapshot">Snapshot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/faucet">Faucet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/spammer">Spammer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apis/tools">Tools</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tooling</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tooling">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tooling/docker_private_network">Docker Private Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tooling/integration_tests">Integration Tests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Team Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/teamresources/release">How To Do a Release</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/teamresources/guidelines">Code Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/teamresources/local_development">Local Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/teamresources/analysis_dashboard">Modify the Analysis Dashboard</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Mana Implementation</h1></header><p>This document provides a high level overview of how mana is implemented in GoShimmer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Mana is a reputation system for nodes within the IOTA network.</p><p>Reputation is gained by contributing to the network, i.e. creating value transfers.
As time passes, part of the earned mana of a node decays to encourage keeping up the good behavior.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="scope"></a>Scope<a class="hash-link" href="#scope" title="Direct link to heading">#</a></h2><p>The scope of the first implementation of mana into GoShimmer is to verify that mana calculations work,
study base mana calculations 1 &amp; 2, and mana distribution in the test network, furthermore to verify that nodes have
similar view on the network.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mana-calculation"></a>Mana Calculation<a class="hash-link" href="#mana-calculation" title="Direct link to heading">#</a></h2><p>Mana is essentially the reputation score of a node in the IOTA network. Mana is calculated locally in each node, as a
function that takes value transactions as input and produces the Base Mana Vector as output.</p><p>Each transaction has an <code>accessMana</code> and <code>consensusMana</code> field that determine which node to pledge these two types
of mana to. Both of these fields denote a <code>nodeID</code>, the receiver of mana. <code>accessMana</code> and <code>consensusMana</code> do not have
to be pledged to the same node, but for simplicity, in the first implementation, they will be.</p><p>In addition to the mana fields, a <code>timestamp</code> field is also added to the transactions that will be utilized for calculating
decay and effective mana.</p><p>From the pledged mana of a transaction, a node can calculate locally the <code>Base Mana Vector</code> for both <code>Access Mana</code> and
<code>Consensus Mana</code>.</p><p>A <code>Base Mana Vector</code> consists of Base Mana 1 and Base Mana 2 and their respective <code>Effective Base Mana</code>.
Given a value transaction, Base Mana 1 and Base Mana 2 are determined as follows:</p><ol><li>Base Mana 1 is revoked from the node that created the output(s) used as input(s) in the transaction, and is pledged to
the node creating the new output(s). The amount of <code>Base Mana 1</code> revoked and pledged is equal to the balance of the
input.</li><li>Base Mana 2 is freshly created at the issuance time of the transaction, awarded to the node, but decays with time.
The amount of <code>Base Mana 2</code> pledged is determined with <code>Pending Mana</code> concept: funds sitting at an address generate
<code>pending mana</code> that grows over time, but bounded.<ul><li><code>Mana_pending = (alpha*S)/gamma*(1-e^(-gamma*t))</code>, where <code>alpha</code> and <code>gamma</code> are chosen parameters, <code>S</code> is the amount
of funds an output transfers to the address, and <code>t</code> is the time since the funds are on that address.</li></ul></li></ol><p>An example <code>Base Mana Vector</code> for <code>Access Mana</code> could look like this:</p><table><thead><tr><th></th><th>Node 1</th><th>Node 2</th><th>...</th><th>Node k</th></tr></thead><tbody><tr><td>Base Mana 1</td><td>0</td><td>1</td><td>...</td><td>100.54</td></tr><tr><td>Effective Base Mana 1</td><td>0</td><td>0.5</td><td>...</td><td>120.7</td></tr><tr><td>Base Mana 2</td><td>0</td><td>1.2</td><td>...</td><td>0.01</td></tr><tr><td>Effective Base Mana 2</td><td>0</td><td>0.6</td><td>...</td><td>0.015</td></tr></tbody></table><p><code>Base Mana</code> is pledged or revoked at discrete times, which results in <code>Base Mana</code> being discontinuous function over time.
In order to make mana &quot;smoother&quot; and continuous, an exponential moving average is applied to the <code>Base Mana</code> values,
resulting in <code>Effective Base Mana 1</code> and <code>Effective Base Mana 2</code>.</p><p>It is important to note, that consuming a new transaction and pledging its mana happens when the transaction is
confirmed on the node. At the same time, entries of the nodes whose mana is being modified during pledging in the
<code>Base Mana Vector(s)</code> are updated with respect to time. In general, updates due to time happen whenever a node&#x27;s mana is
being accessed. Except for the aforementioned case, this could be for example a mana related query from an external
module (FPC, Autopeering, DRNG, Rate Control, tools, etc.).</p><p>Following figure summarizes how <code>Access Mana</code> and <code>Consensus Mana</code> is derived from a transaction:</p><p><img alt="Mana" src="/assets/images/mana-2744403e9cd06bba40f66102157f662d.png" title="Mana"></p><p>The reason for having two separate <code>Base Mana Vectors</code> is the fact, that <code>accessMana</code> and <code>consensusMana</code> can be pledged
to different nodes.</p><p>The exact mathematical formulas, and their respective parameters will be determined later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="challenges"></a>Challenges<a class="hash-link" href="#challenges" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dependency-on-tangle"></a>Dependency on Tangle<a class="hash-link" href="#dependency-on-tangle" title="Direct link to heading">#</a></h3><p>Since mana is awarded to nodes submitting value transfers, the tangle is needed as input for mana calculation.
Each node calculates mana locally, therefore, it is essential to determine when to consider transactions in the
tangle &quot;final enough&quot; (so that they will not be orphaned).</p><p>When a transaction is <code>confirmed</code>, it is a sufficient indicator that it will not be orphaned. However, in current
GoShimmer implementation, confirmation is not yet a properly defined concept. This issue will be addressed in a separate
module.</p><p>The Mana module assumes, that the (value) tangle&#x27;s <code>TransactionConfirmed</code> event is the trigger condition to update the
mana state machine (base mana vectors for access and consensus mana). Once the concept of transaction finality is
introduced for the tangle, the trigger conditions for access and consensus mana calculations can be adjusted.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transaction-layout"></a>Transaction Layout<a class="hash-link" href="#transaction-layout" title="Direct link to heading">#</a></h3><p>A new field should be added to <code>Transaction</code> denoting <code>PledgedNodeID</code> for <code>Access Mana</code> and <code>Consensus Mana</code>.
This is also beneficial to implement mana donation feature, that is, to donate the mana of a certain transaction to an
arbitrary node.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="limitations"></a>Limitations<a class="hash-link" href="#limitations" title="Direct link to heading">#</a></h2><p>The first implementation of mana in GoShimmer will:</p><ul><li>not have voted timestamps on value transactions,</li><li>lack proper <code>TransactionConfirmed</code> mechanism to trigger mana update,</li><li>lack integration into rate control/autopeering/fpc/etc.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="detailed-design"></a>Detailed Design<a class="hash-link" href="#detailed-design" title="Direct link to heading">#</a></h2><p>In this section, detailed GoShimmer implementation design considerations will be outlined about the mana module.
In short, changes can be classified into 3 categories:</p><ol><li>Transaction related changes,</li><li>Mana module functionality,</li><li>and related tools/utilities, such as API, visualization, analytics.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transaction"></a>Transaction<a class="hash-link" href="#transaction" title="Direct link to heading">#</a></h3><p>As described above, 3 new fields will be added to the transaction layout:</p><ol><li><code>Timestamp</code> time.time</li><li><code>AccessManaNodeID</code> []bytes</li><li><code>ConsensusManaNodeID</code> []bytes</li></ol><p>By adding these fields to the signed transaction, <code>valuetransfers/packages/transaction</code> should be modified.</p><ul><li>The three new fields should be added to the transaction essence.</li><li>Marshalling and unmarshalling of a transaction should be modified.</li><li>For calculating <code>Base Mana 1</code> values, <code>mana module</code> should be able to derive from a transaction the nodes which received
pledged <code>Base Mana 1</code> as a consequence of the consumed inputs of the transaction. Therefore, a lookup function should
be exposed from the value tangle that given an <code>input</code>, returns the <code>pledgedNodeID</code> of the transaction creating the input.</li></ul><p><code>Timestamp</code> is part of the signed transaction, therefore, a client sending a transaction to the node should already
define it. In this case, this <code>Timestamp</code> will not be the same as the timestamp of the message containing the
transaction and value payload, since the message is created on the node.
A solution to this is that upon receiving a <code>transaction</code> from a client, the node checks if the timestamp is within
a predefined time window, for example <code>t_current - delta</code>, where <code>delta</code> could be couple seconds. If true, then the node
constructs the message, which must have a greater timestamp, than the transaction.</p><p><code>AccessManaNodeID</code> and <code>ConsensusManaNodeID</code> are also part of the signed transaction, so a client should fill them out.
Node owners are free to choose to whom they pledge mana to with the transaction, so there should be a mechanism that
lets the client know, what <code>AccessManaNodeID</code> and <code>ConsensusManaNodeID</code> are allowed. This could be a new API endpoint
that works like this:</p><ol><li>Client asks node what nodeIDs can be included for pledging  a certain type (access, consensus) mana.</li><li>Node answers with either:</li></ol><ul><li>Don&#x27;t care. Any node IDs are valid.</li><li>List of nodeIDs that are allowed for each type.</li></ul><ol start="3"><li>If a client sends back the transaction with invalid or empty mana fields, the transaction is considered invalid.</li></ol><p>This way node owners can decide who their transactions are pledging mana to. It could be only their node, or they could
provide mana pledging as a service. They could delegate access mana to others, but hold own to consensus mana, or the
other way around.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initialization"></a>Initialization<a class="hash-link" href="#initialization" title="Direct link to heading">#</a></h3><p>Mana state machine is an extension of the ledger state, hence its calculation depends on the ledger state perception
of the node. Snapshotting is the mechanism that saves the ledger states and prunes unnecessary transactions. Together
with the ledger state, base mana vectors are also saved, since a certain ledger state reflects a certain mana distribution
in the network. In future, when snapshotting is implemented in GoShimmer, nodes joining the network will be able to query
for snapshot files that will contain initial base mana vectors as well.</p><p>Until this functionality is implemented, mana calculation solely relies on transactions getting confirmed. That is, when
a node joins the network and starts gathering messages and transactions from peers, it builds its own ledger state through
solidification process. Essentially, the node requests all messages down to the genesis from the current tips of its neighbors.
Once the genesis is found, messages are solidified bottom up. For the value tangle, this means that for each solidified
and liked transaction, <code>TransactionConfirmed</code> event is triggered, updating the base mana vectors.</p><p>In case of a large database, initial synching and solidification is a computationally heavy task due to the sheer amount
of messages in the tangle. Mana calculation only adds to this burden. It will be determined through testing if additional
&quot;weight lifting&quot; mechanism is needed (for example delaying mana calculation).</p><p>In the GoShimmer test network, all funds are initially held by the faucet node, therefore all mana present at bootstrap belong
to this node. Whenever a transaction is requested from the faucet, it pledges mana to the requesting node, helping other
nodes to increase their mana.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mana-package"></a>Mana Package<a class="hash-link" href="#mana-package" title="Direct link to heading">#</a></h3><p>The functionality of the mana module should be implemented in a <code>mana</code> package. Then, a <code>mana plugin</code> can use the package
structs and methods to connect the dots, for example execute <code>BookMana</code> when <code>TransactionConfirmed</code> event is triggered
in the value tangle.</p><p><code>BaseMana</code> is a struct that holds the different mana values for a given node.
Note that except for <code>Base Mana 1</code> calculation, we need the time when <code>BaseMana</code> values were updated, so we store it in the struct:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> BaseMana </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> BaseMana1 float</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> EffectiveBaseMana1 float</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> BaseMana2 float</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> EffectiveBaseMana2 float</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LastUpdated time</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>BaseManaVector</code> is a data structure that maps <code>nodeID</code>s to <code>BaseMana</code>. It also has a <code>Type</code> that denotes the type
of mana this vector deals with (Access, Consensus, etc.).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> BaseManaVector </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vector     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">identity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">*</span><span class="token plain">BaseMana</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vectorType Type</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="methods"></a>Methods<a class="hash-link" href="#methods" title="Direct link to heading">#</a></h4><p><code>BaseManaVector</code> should have the following methods:</p><ul><li><code>BookMana(transaction)</code>: Book mana of a transaction. Trigger <code>ManaBooked</code> event. Note, that this method updates
<code>BaseMana</code> with respect to time and to new <code>Base Mana 1</code> and <code>Base Mana 2</code> values.</li><li><code>GetWeightedMana(nodeID, weight) mana</code>: Return <code>weight</code> *<code> Effective Base Mana 1</code> + (1-<code>weight</code>)+<code>Effective Base Mana 2</code>.
<code>weight</code> is a number in [0,1] interval. Notice, that <code>weight</code> = 1  results in only returning <code>Effective Base Mana 1</code>,
and the other way around. Note, that this method also updates <code>BaseMana</code> of the node with respect to time.</li><li><code>GetMana(nodeID) mana</code>: Return 0.5<em><code>Effective Base Mana 1</code> + 0.5</em><code>Effective Base Mana 2</code> of a particular node. Note, that
this method also updates <code>BaseMana</code> of the node with respect to time.</li><li><code>update(nodeID, time)</code>: update <code>Base Mana 2</code>, <code>Effective Base Mana 1</code> and <code>Effective Base Mana 2</code> of a node with respect <code>time</code>.</li><li><code>updateAll(time)</code>: update <code>Base Mana 2</code>, <code>Effective Base Mana 1</code> and <code>Effective Base Mana 2</code> of all nodes with respect to <code>time</code>.</li></ul><p><code>BaseMana</code> should have the following methods:</p><ul><li><code>pledgeAndUpdate(transaction)</code>: update <code>BaseMana</code> fields and pledge mana with respect to <code>transaction</code>.</li><li><code>revokeBaseMana1(amount, time)</code>:  update <code>BaseMana</code> values with respect to <code>time</code> and revoke <code>amount</code> <code>BaseMana1</code>.</li><li><code>update(time)</code>: update all <code>BaseMana</code> fields with respect to <code>time</code>.</li><li><code>updateEBM1(time)</code>: update <code>Effective Base Mana 1</code> wrt to <code>time</code>.</li><li><code>updateBM2(time)</code>: update <code>Base Mana 2</code> wrt to <code>time</code>.</li><li><code>updateEBM2(time)</code>: update <code>Effective Base Mana 2</code> wrt to <code>time</code>.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="base-mana-calculation"></a>Base Mana Calculation<a class="hash-link" href="#base-mana-calculation" title="Direct link to heading">#</a></h4><p>There are two cases when the values within <code>Base Mana Vector</code> are updated:</p><ol><li>A confirmed transaction pledges mana.</li><li>Any module accesses the <code>Base Mana Vector</code>, and hence its values are updated with respect to <code>access time</code>.</li></ol><p>First, let&#x27;s explore the former.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-confirmed-transaction-pledges-mana"></a>A confirmed transaction pledges mana<a class="hash-link" href="#a-confirmed-transaction-pledges-mana" title="Direct link to heading">#</a></h5><p>For simplicity, we only describe mana calculation for one of the Base Mana Vectors, namely, the Base Access Mana Vector.</p><p>First, a <code>TransactionConfirmed</code> event is triggered, therefore <code>BaseManaVector.BookMana(transaction)</code> is executed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bmv </span><span class="token operator">*</span><span class="token plain">BaseManaVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">BookMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx </span><span class="token operator">*</span><span class="token plain">transaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pledgedNodeID </span><span class="token operator">:=</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">accessMana</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> input </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">range</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">inputs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// search for the nodeID that the input&#x27;s tx pledged its mana to</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        inputNodeID </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">loadPledgedNodeIDFromInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// save it for proper event trigger</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        oldMana </span><span class="token operator">:=</span><span class="token plain"> bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">inputNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// revoke BM1</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">inputNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">revokeBaseMana1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">balance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// trigger events</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ManaRevoked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">ManaRevokedEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">inputNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">balance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AccessManaType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ManaUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Tigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">ManaUpdatedEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">inputNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> oldMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">inputNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AccessManaType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// save it for proper event trigger</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    oldMana </span><span class="token operator">:=</span><span class="token plain">  bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">pledgedNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// actually pledge and update</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm1Pledged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bm2Pledged </span><span class="token operator">:=</span><span class="token plain"> bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">pledgedNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">pledgeAndUpdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// trigger events</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ManaPledged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">ManaPledgedEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">pledgedNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bm1Pledged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bm2Pledged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AccessManaType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ManaUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">ManaUpdatedEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">pledgedNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> oldMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">pledgedNodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AccessManaType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Base Mana 1</code> is being revoked from the nodes that pledged mana for inputs that the current transaction consumes.
Then, the appropriate node is located in <code>Base Mana Vector</code>, and mana is pledged to its <code>BaseMana</code>.
<code>Events</code> are essential to study what happens within the module from the outside.</p><p>Note, that <code>revokeBaseMana1</code> accesses the mana entry of the nodes within <code>Base Mana Vector</code>, therefore all values are
updated with respect to <code>t</code>. Notice the two branches after the condition. When <code>Base Mana</code> values had been updated before
the transaction&#x27;s timestamp, a regular update is carried out. However, if <code>t</code> is older, than the transaction timestamp,
an update in the &quot;past&quot; is carried out and values are updated up to <code>LastUpdated</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">revokeBaseMana1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">amount </span><span class="token builtin" style="color:rgb(189, 147, 249)">float64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">After</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// regular update</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        n </span><span class="token operator">:=</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// first, update EBM1, BM2 and EBM2 until `t`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated </span><span class="token operator">=</span><span class="token plain"> t</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// revoke BM1 at `t`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana1 </span><span class="token operator">-=</span><span class="token plain"> amount</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// update in past</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        n </span><span class="token operator">:=</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// revoke BM1 at `t`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana1 </span><span class="token operator">-=</span><span class="token plain"> amount</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// update EBM1 to `bm.LastUpdated`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana1 </span><span class="token operator">-=</span><span class="token plain"> amount</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token plain">EMA_coeff_1</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The same regular and past update scheme is applied to pledging mana too:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">pledgeAndUpdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx </span><span class="token operator">*</span><span class="token plain">transaction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm1Pledged </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bm2Pledged </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    t </span><span class="token operator">:=</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">timestamp</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm1Pledged </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sum_balance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">inputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">After</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// regular update</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        n </span><span class="token operator">:=</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// first, update EBM1, BM2 and EBM2 until `t`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated </span><span class="token operator">=</span><span class="token plain"> t</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana1 </span><span class="token operator">+=</span><span class="token plain"> bm1Pledged</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// pending mana awarded, need to see how long funds sat</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> input </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">range</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">inputs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// search for the timestamp of the UTXO that generated the input</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            t_inp </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">LoadTxTimestampFromOutputID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm2Add </span><span class="token operator">:=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">balance </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token operator">-</span><span class="token plain">t_inp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">+=</span><span class="token plain"> bm2Add</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm2Pledged </span><span class="token operator">+=</span><span class="token plain"> bm2Add</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// past update</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        n </span><span class="token operator">:=</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// update BM1 and BM2 at `t`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana1 </span><span class="token operator">+=</span><span class="token plain"> bm1Pledged</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        oldMana2 </span><span class="token operator">=</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> input </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">range</span><span class="token plain"> tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">inputs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// search for the timestamp of the UTXO that generated the input</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            t_inp </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">LoadTxTimestampFromOutputID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm2Add </span><span class="token operator">:=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">balance </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token operator">-</span><span class="token plain">t_inp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">+=</span><span class="token plain"> bm2Add</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm2Pledged </span><span class="token operator">+=</span><span class="token plain"> bm2Add</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// update EBM1 and EBM2 to `bm.LastUpdated`</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana1 </span><span class="token operator">+=</span><span class="token plain"> amount</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token plain">EMA_coeff_1</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> EMA_coeff_2 </span><span class="token operator">!=</span><span class="token plain"> decay </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">-</span><span class="token plain"> oldMana2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">EMA_coeff_2</span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">-</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token operator">-</span><span class="token plain">EMA_coeff_2</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">EMA_coeff_2</span><span class="token operator">-</span><span class="token plain">decay</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">-</span><span class="token plain"> oldMana2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> decay </span><span class="token operator">*</span><span class="token plain"> n</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> bm1Pledged</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bm2Pledged</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice, that in case of <code>EMA_coeff_2 = decay</code>, a simplified formula can be used to calculate <code>EffectiveBaseMana2</code>.
The same approach is applied in <code>updateEBM2()</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana1 </span><span class="token operator">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">EMA_coeff_1 </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana1 </span><span class="token operator">+</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">EMA_coeff_1 </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">updateBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">=</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2 </span><span class="token operator">*</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay</span><span class="token operator">*</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> EMA_coeff_2 </span><span class="token operator">!=</span><span class="token plain"> decay </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">emaCoeff2 </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">+</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">EMA_coeff_2 </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">EMA_coeff_2 </span><span class="token operator">-</span><span class="token plain"> decay</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> EMA_coeff_2 </span><span class="token operator">/</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">*</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">=</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">E</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">decay </span><span class="token operator">*</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">*</span><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">EffectiveBaseMana2 </span><span class="token operator">+</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            decay </span><span class="token operator">*</span><span class="token plain"> n </span><span class="token operator">*</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">BaseMana2</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="any-module-accesses-the-base-mana-vector"></a>Any module accesses the Base Mana Vector<a class="hash-link" href="#any-module-accesses-the-base-mana-vector" title="Direct link to heading">#</a></h5><p>In this case, the accessed entries within <code>Base Mana Vector</code> are updated via the method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bmv </span><span class="token operator">*</span><span class="token plain">BaseManaVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">update</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">nodeID ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Time </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    oldMana </span><span class="token operator">:=</span><span class="token plain">  bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">nodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">nodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">update</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ManaUpdated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">ManaUpdatedEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">nodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> oldMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bmv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">nodeID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AccessManaType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where <code>t</code> is the access time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bm </span><span class="token operator">*</span><span class="token plain">BaseMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">update</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">t time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Time </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n </span><span class="token operator">:=</span><span class="token plain"> t </span><span class="token operator">-</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">updateEBM2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LastUpdated </span><span class="token operator">=</span><span class="token plain"> t</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="events"></a>Events<a class="hash-link" href="#events" title="Direct link to heading">#</a></h4><p>The mana package should have the following events:</p><ul><li><code>Pledged</code> when mana (<code>BM1</code> and <code>BM2</code>) was pledged for a node due to new transactions being confirmed.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> PledgedEvent </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    NodeID </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">bytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AmountBM1 </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AmountBM2 </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Time time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Time</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Type ManaType </span><span class="token comment" style="color:rgb(98, 114, 164)">// access or consensus</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>Revoked</code> when mana (<code>BM1</code>) was revoked from a node.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> RevokedEvent </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    NodeID </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">bytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AmountBM1 </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Time time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Time</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Type ManaType </span><span class="token comment" style="color:rgb(98, 114, 164)">// access or consensus</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>Updated</code> when mana was updated for a node due to it being accessed.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> UpdatedEvent </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    NodeID </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">bytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    OldMana BaseMana</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    NewMana BaseMana</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Type    ManaType </span><span class="token comment" style="color:rgb(98, 114, 164)">// access or consensus</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h4><ul><li>Write unit tests for all methods.</li><li>Test all events and if they are correctly triggered.</li><li>Benchmark calculations in tests to see how heavy it is to calculate EMAs and decays.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mana-plugin"></a>Mana Plugin<a class="hash-link" href="#mana-plugin" title="Direct link to heading">#</a></h3><p>The <code>mana plugin</code> is responsible for:</p><ul><li>calculating mana from value transactions,</li><li>keeping a log of the different mana values of all nodes,</li><li>updating mana values,</li><li>responding to mana related queries from other modules,</li><li>saving base mana vectors in database when shutting down the node,</li><li>trying to load base mana vectors from database when starting the node.</li></ul><p>The proposed mana plugin should keep track of the different mana values of nodes and handle calculation
updates. Mana values are mapped to <code>nodeID</code>s and stored in a <code>map</code> data structure. The vector also stores information on
what <code>Type</code> of mana it handles.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> BaseManaVector </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vector     </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">identity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">*</span><span class="token plain">BaseMana</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vectorType Type</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Access Mana</code> and <code>Consensus Mana</code> should have their own respective <code>BaseManaVector</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">accessManaVector </span><span class="token operator">:=</span><span class="token plain"> BaseManaVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">vectorType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> AccesMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">consensusManaVector </span><span class="token operator">:=</span><span class="token plain">  BaseManaVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">vectorType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ConsensusMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the future, it should be possible to combine <code>Effective Base Mana 1</code> and <code>Effective Base Mana 2</code> from a <code>BaseManaVector</code>
in arbitrary proportions to arrive at a final mana value that other modules use. The <code>mana package</code> has these methods
in place. Additionally, a parameter could be passed to the <code>getMana</code> type of exposed functions to set the proportions.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="methods-1"></a>Methods<a class="hash-link" href="#methods-1" title="Direct link to heading">#</a></h4><p>The mana plugin should expose utility functions to other modules:</p><ul><li><code>GetHighestManaNodes(type, n) [n]NodeIdManaTuple</code>: return the <code>n</code> highest <code>type</code> mana nodes (<code>nodeID</code>,<code>manaValue</code>) in
ascending order. Should also update their mana value.</li><li><code>GetManaMap(type) map[nodeID]manaValue</code>: return <code>type</code> mana perception of the node.</li><li><code>GetAccessMana(nodeID) mana</code>: access <code>Base Mana Vector</code> of <code>Access Mana</code>, update its values with respect to time,
and return the amount of <code>Access Mana</code> (either <code>Effective Base Mana 1</code>, <code>Effective Base Mana 2</code>, or some combination
of the two). Trigger <code>ManaUpdated</code> event.</li><li><code>GetConsensusMana(nodeID) mana</code>: access <code>Base Mana Vector</code> of <code>Consensus Mana</code>, update its values with respect to time,
and returns the amount of <code>Consensus Mana</code> (either <code>Effective Base Mana 1</code>, <code>Effective Base Mana 2</code>, or some combination
of the two). Trigger <code>ManaUpdated</code> event.</li><li><code>GetNeighborsMana(type)</code>: returns the <code>type</code> mana of the nodes neighbors</li><li><code>GetAllManaVectors()</code> Obtaining the full mana maps for comparison with the perception of other nodes.</li><li><code>GetWeightedRandomNodes(n)</code>: returns a weighted random selection of <code>n</code> nodes. <code>Consensus Mana</code> is used for the weights.</li><li>Obtaining a list of currently known peers + their mana, sorted. Useful for knowing which high mana nodes are online.</li><li><code>OverrideMana(nodeID, baseManaVector)</code>: Sets the nodes mana to a specific value. Can be useful for debugging, setting faucet mana, initialization, etc.. Triggers <code>ManaUpdated</code></li></ul><p>Such utility functions could be used for example to visualize mana distribution in node dashboard, or send neighbor
mana data to the analysis server for further processing.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="booking-mana"></a>Booking Mana<a class="hash-link" href="#booking-mana" title="Direct link to heading">#</a></h4><p>Mana is booked when a transaction is confirmed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">on TransactionConfirmed </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bookAccessMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bookConsensusMana</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="synchronization-and-mana-calculation"></a>Synchronization and Mana Calculation<a class="hash-link" href="#synchronization-and-mana-calculation" title="Direct link to heading">#</a></h4><p>The mana plugin is responsible to determine when to start calculating mana locally.
Since mana state is an extension to ledger state, it can only depict realistic mana values once the node is in sync.
During syncing, ledger state is constructed from messages coming from neighbors as described further above.</p><p>In this first iteration, mana plugin relies on <code>TransactionConfirmed</code> event of the value transfers plugin, and has no
explicit rules on when to start and stop mana calculation.</p><p>In future, initial mana state (together with the initial ledger state) will be derived from a snapshot file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mana-toolkit"></a>Mana Toolkit<a class="hash-link" href="#mana-toolkit" title="Direct link to heading">#</a></h3><p>In this section, all tools and utility functions for mana will be outlined.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mana-related-api-endpoints"></a>Mana Related API endpoints<a class="hash-link" href="#mana-related-api-endpoints" title="Direct link to heading">#</a></h4><ul><li><code>/info</code>: Add own mana in node info response.</li><li><code>value/allowedManaPledge</code>: Endpoint that clients can query to determine which nodeIDs are allowed as part of
<code>accessMana</code> and <code>consensusMana</code> fields in a transaction.</li><li><code>value/sendTransactionByJson</code>: Add <code>accessMana</code>, <code>consensusMana</code> and <code>timestamp</code> fields to the JSON request.</li></ul><p>Add a new <code>mana</code> endpoint route:</p><ul><li><code>/mana</code>: Return access and consensus mana of the node.</li><li><code>/mana/all</code>: Return whole mana map (mana perception of the node).</li><li><code>/mana/access/nhighest</code>: Return <code>n</code> highest access mana holder <code>nodeIDs</code> and their access mana values.</li><li><code>/mana/consensus/nhighest</code>: Return <code>n</code> highest consensus mana holder <code>nodeIDs</code> and their consensus mana values.</li><li><code>/mana/percentile</code>: Return the top percentile the node belongs to relative to the network. For example, if there are 100 nodes in the
network owning mana, and a node is the 13th richest, it means that is part of the top 13% of mana holders, but not the
top 12%.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metrics-collection"></a>Metrics collection<a class="hash-link" href="#metrics-collection" title="Direct link to heading">#</a></h4><p>To study the mana module, following metrics could be gathered:</p><ul><li>Amount of consensus and access mana present in the network. (amount varies because of <code>Base Mana 2</code>).</li><li>Amount of mana each node holds.</li><li>Number of (and amount of mana) a node was pledged with mana in the last <code>t</code> interval.</li><li>Mana development of a particular node over time.</li><li>Mana percentile development of a node over time.</li><li>Average pledge amount of a node. (how much mana it receives on average with one pledge)</li><li>Mean and median mana holdings of nodes in the network. Shows how even mana distribution is.</li><li>Average mana of neighbors.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="visualization"></a>Visualization<a class="hash-link" href="#visualization" title="Direct link to heading">#</a></h4><p>Each node calculates mana locally, not only for themselves, but for all nodes in the network that it knows. As a result,
mana perception of nodes may not be exactly the same at all times (due to network delay, processing capabilities), but
should converge to the same state. A big question for visualization is which node&#x27;s viewpoint to base mana visualization on? </p><p>When running a node, operators will be shown the mana perception of their own node, but it also makes sense to
display the perception of high mana nodes as the global mana perception. First, let&#x27;s look at how local mana perception
is visualized for a node:</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="local-perception"></a>Local Perception<a class="hash-link" href="#local-perception" title="Direct link to heading">#</a></h5><p>There are two ways to visualize mana in GoShimmer:</p><ol><li>Node Local Dashboard</li><li>Grafana Dashboard</li></ol><p>While <code>Local Dashboard</code> gives flexibility in what and how to visualize, <code>Grafana Dashboard</code> is better at storing historic
data but can only visualize time series. Therefore, both of these ways will be utilized, depending on which suits the best.</p><p><code>Local Dashboard</code> visualization:</p><ul><li>Histogram of mana distribution within the network.</li><li>List of <code>n</code> richest mana nodes, ordered.</li><li>Mana rank of node.</li></ul><p><code>Grafana Dashboard</code> visualization:</p><ul><li><p>Mana of a particular node with respect to time.</p></li><li><p>Amount of mana in the network.</p></li><li><p>Average pledge amount of a node.</p></li><li><p>Mean and median mana holdings of nodes.</p></li><li><p>Mana rank of the node over time.</p></li><li><p>Average mana of neighbors.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="global-perception"></a>Global Perception<a class="hash-link" href="#global-perception" title="Direct link to heading">#</a></h5></li></ul><p>Additionally, the GoShimmer Analyzer (analysis server) could be updated:</p><ul><li>Autopeering node graph, where size of a node corresponds to its mana value.</li><li>Some previously described metrics could be visualized here as well, to give the chance to people without
a node to take a look. As an input, a high mana node&#x27;s perception should be used.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/iotaledger/Goshimmer/tree/develop/docOps/docs/protocol_specification/mana.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/protocol_specification/autopeering"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Autopeering</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/protocol_specification/congestion_control"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Congestion Control Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#scope" class="table-of-contents__link">Scope</a></li><li><a href="#mana-calculation" class="table-of-contents__link">Mana Calculation</a></li><li><a href="#challenges" class="table-of-contents__link">Challenges</a><ul><li><a href="#dependency-on-tangle" class="table-of-contents__link">Dependency on Tangle</a></li><li><a href="#transaction-layout" class="table-of-contents__link">Transaction Layout</a></li></ul></li><li><a href="#limitations" class="table-of-contents__link">Limitations</a></li><li><a href="#detailed-design" class="table-of-contents__link">Detailed Design</a><ul><li><a href="#transaction" class="table-of-contents__link">Transaction</a></li><li><a href="#initialization" class="table-of-contents__link">Initialization</a></li><li><a href="#mana-package" class="table-of-contents__link">Mana Package</a></li><li><a href="#mana-plugin" class="table-of-contents__link">Mana Plugin</a></li><li><a href="#mana-toolkit" class="table-of-contents__link">Mana Toolkit</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/welcome">Welcome</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/setup">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/implementation_design/event_driven_model">Implementation Design</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/protocol_specification">Protocol Specification</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/apis/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tooling">Tooling</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/teamresources/release">Team Resources</a></li></ul></div><div class="col footer__col"><div class="footer__title">Articles</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/iotaledger/Goshimmer" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 IOTA Foundation, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dedbe278.js"></script>
<script src="/assets/js/main.0e69db9d.js"></script>
</body>
</html>